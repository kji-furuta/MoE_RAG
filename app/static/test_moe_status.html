<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>MoE-RAG ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .status-box { padding: 20px; margin: 10px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background: #e8f5e9; border-color: #4caf50; }
        .error { background: #ffebee; border-color: #f44336; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        .expert-item { margin: 5px 0; padding: 5px 10px; background: #f5f5f5; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>MoE-RAG ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
    
    <button onclick="checkStatus()">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª</button>
    <button onclick="checkExperts()">ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆæƒ…å ±</button>
    <button onclick="analyzeQuery()">ã‚¯ã‚¨ãƒªåˆ†æãƒ†ã‚¹ãƒˆ</button>
    
    <div id="result"></div>
    
    <script>
        async function checkStatus() {
            const resultDiv = document.getElementById('result');
            try {
                const response = await fetch('http://localhost:8050/api/moe-rag/status');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="status-box success">
                        <h3>âœ… MoE-RAGã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
                        <p>åˆ©ç”¨å¯èƒ½: ${data.available ? 'ã¯ã„' : 'ã„ã„ãˆ'}</p>
                        <p>åˆæœŸåŒ–æ¸ˆã¿: ${data.initialized ? 'ã¯ã„' : 'ã„ã„ãˆ'}</p>
                        <p>ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒ«ãƒ¼ã‚¿ãƒ¼: ${data.components.expert_router ? 'âœ…' : 'âŒ'}</p>
                        <p>ãƒ¬ã‚¹ãƒãƒ³ã‚¹èåˆ: ${data.components.response_fusion ? 'âœ…' : 'âŒ'}</p>
                        <p>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—: ${new Date(data.timestamp).toLocaleString('ja-JP')}</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status-box error">
                        <h3>âŒ ã‚¨ãƒ©ãƒ¼</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function checkExperts() {
            const resultDiv = document.getElementById('result');
            try {
                const response = await fetch('http://localhost:8050/api/moe-rag/experts');
                const data = await response.json();
                
                let html = `
                    <div class="status-box success">
                        <h3>ğŸ‘¥ å°‚é–€ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ (${data.total}å)</h3>
                `;
                
                data.experts.forEach(expert => {
                    html += `
                        <div class="expert-item" style="border-left: 3px solid ${expert.color};">
                            ${expert.icon} <strong>${expert.name}</strong>
                            <br>
                            <small>${expert.description}</small>
                        </div>
                    `;
                });
                
                html += '</div>';
                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status-box error">
                        <h3>âŒ ã‚¨ãƒ©ãƒ¼</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function analyzeQuery() {
            const query = prompt('åˆ†æã™ã‚‹ã‚¯ã‚¨ãƒªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:', 'è¨­è¨ˆé€Ÿåº¦80km/hã®é“è·¯ã«ãŠã‘ã‚‹æœ€å°æ›²ç·šåŠå¾„ã¯ï¼Ÿ');
            if (!query) return;
            
            const resultDiv = document.getElementById('result');
            try {
                const response = await fetch(`http://localhost:8050/api/moe-rag/analyze?query=${encodeURIComponent(query)}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="status-box success">
                        <h3>ğŸ” ã‚¯ã‚¨ãƒªåˆ†æçµæœ</h3>
                        <p><strong>ã‚¯ã‚¨ãƒª:</strong> ${data.query}</p>
                        <p><strong>ä¸»è¦ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ:</strong> ${data.primary_experts.join(', ')}</p>
                        <p><strong>æˆ¦ç•¥:</strong> ${data.routing_strategy}</p>
                        <p><strong>ä¿¡é ¼åº¦:</strong> ${(data.confidence * 100).toFixed(1)}%</p>
                        <p><strong>è¤‡é›‘åº¦:</strong> ${(data.complexity.complexity_score * 100).toFixed(1)}%</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status-box error">
                        <h3>âŒ ã‚¨ãƒ©ãƒ¼</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•å®Ÿè¡Œ
        window.onload = () => {
            checkStatus();
        };
    </script>
</body>
</html>