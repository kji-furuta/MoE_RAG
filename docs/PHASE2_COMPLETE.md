# Phase 2 å®Ÿè£…å®Œäº† - DIã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“‹ æ¦‚è¦

Phase 2ã¨ã—ã¦ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸï¼š
1. **ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã‚³ãƒ³ãƒ†ãƒŠ** - ã‚µãƒ¼ãƒ“ã‚¹ã®ç®¡ç†ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«åˆ¶å¾¡
2. **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ ** - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¥å…¨æ€§ç›£è¦–
3. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚·ã‚¹ãƒ†ãƒ ** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã¨æœ€é©åŒ–
4. **ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ãƒ„ãƒ¼ãƒ«** - è‡ªå‹•æœ€é©åŒ–ã¨æ¨å¥¨äº‹é …

## ğŸ¯ å®Ÿè£…ã—ãŸæ©Ÿèƒ½

### 1. DIã‚³ãƒ³ãƒ†ãƒŠ (`container.py`)

#### ä¸»ãªæ©Ÿèƒ½
- **ã‚µãƒ¼ãƒ“ã‚¹ç™»éŒ²ã¨è§£æ±º**: å‹ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†
- **ã‚¹ã‚³ãƒ¼ãƒ—ç®¡ç†**: Singletonã€Transientã€Scoped
- **è‡ªå‹•ä¾å­˜é–¢ä¿‚è§£æ±º**: ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
- **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†**: ä½œæˆãƒ»ç ´æ£„ãƒ•ãƒƒã‚¯

#### ä½¿ç”¨ä¾‹
```python
from src.rag.dependencies.container import DIContainer, ServiceScope

# ã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆã¨è¨­å®š
container = DIContainer()
container.register_singleton(ConfigurationService)
container.register(IVectorStore, QdrantVectorStore, ServiceScope.SINGLETON)

# ã‚µãƒ¼ãƒ“ã‚¹ã®å–å¾—
config = container.resolve(ConfigurationService)
vector_store = container.get_service(IVectorStore)

# ã‚¹ã‚³ãƒ¼ãƒ—ã®ä½¿ç”¨
with container.scope() as scope:
    scoped_service = scope.get_service(SomeService)
```

### 2. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ  (`health_check.py`)

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ¥ãƒã‚§ãƒƒã‚«ãƒ¼
- **SystemHealthChecker**: CPUã€ãƒ¡ãƒ¢ãƒªã€ãƒ‡ã‚£ã‚¹ã‚¯ã®ç›£è¦–
- **GPUHealthChecker**: GPUåˆ©ç”¨å¯èƒ½æ€§ã¨ãƒ¡ãƒ¢ãƒªç›£è¦–
- **VectorStoreHealthChecker**: ãƒ™ã‚¯ãƒˆãƒ«DBã®çŠ¶æ…‹ç¢ºèª
- **DependencyHealthChecker**: ä¾å­˜é–¢ä¿‚ã®çŠ¶æ…‹ç¢ºèª

#### ä½¿ç”¨ä¾‹
```python
from src.rag.monitoring.health_check import RAGHealthChecker

health_checker = RAGHealthChecker(container)
result = await health_checker.check_all()

print(f"Overall status: {result.overall_status.value}")
for name, component in result.components.items():
    print(f"{name}: {component.status.value}")

# å®šæœŸãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
await health_checker.start_monitoring()
```

### 3. ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚·ã‚¹ãƒ†ãƒ  (`metrics.py`)

#### ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¿ã‚¤ãƒ—
- **Counter**: ç´¯ç©ã‚«ã‚¦ãƒ³ãƒˆ
- **Gauge**: ç¾åœ¨å€¤
- **Histogram**: åˆ†å¸ƒ
- **Timer**: å®Ÿè¡Œæ™‚é–“

#### ä½¿ç”¨ä¾‹
```python
from src.rag.monitoring.metrics import MetricsCollector

collector = MetricsCollector()

# ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
collector.increment("api.requests", tags={"endpoint": "/rag/query"})

# ã‚²ãƒ¼ã‚¸
collector.gauge("memory.usage", 75.5, unit="percent")

# ã‚¿ã‚¤ãƒãƒ¼
with collector.timer("query.duration"):
    # å‡¦ç†å®Ÿè¡Œ
    pass

# ã‚µãƒãƒªãƒ¼å–å¾—
summary = collector.get_summary("query.duration", MetricType.TIMER)
print(f"Mean: {summary.mean}ms, P95: {summary.p95}ms")
```

### 4. ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ãƒ„ãƒ¼ãƒ« (`optimize_rag_system.py`)

#### æœ€é©åŒ–ã‚«ãƒ†ã‚´ãƒª
- **ä¾å­˜é–¢ä¿‚æœ€é©åŒ–**: ä¸è¶³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç‰¹å®šã¨æ¨å¥¨
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
- **è¨­å®šæœ€é©åŒ–**: è¨­å®šå€¤ã®æœ€é©åŒ–ææ¡ˆ
- **ãƒªã‚½ãƒ¼ã‚¹æœ€é©åŒ–**: ãƒ¡ãƒ¢ãƒªã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç®¡ç†

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ

### çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# Phase 2 çµ±åˆãƒ†ã‚¹ãƒˆ
python3 scripts/test_phase2_integration.py

# ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–
python3 scripts/optimize_rag_system.py
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ†ã‚¹ãƒˆé …ç›® | çµæœ |
|--------------|-----------|------|
| DIã‚³ãƒ³ãƒ†ãƒŠ | ã‚µãƒ¼ãƒ“ã‚¹ç™»éŒ²ãƒ»è§£æ±º | âœ… |
| DIã‚³ãƒ³ãƒ†ãƒŠ | ã‚¹ã‚³ãƒ¼ãƒ—ç®¡ç† | âœ… |
| DIã‚³ãƒ³ãƒ†ãƒŠ | ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ« | âœ… |
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç›£è¦– | âœ… |
| ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | å®šæœŸãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° | âœ… |
| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | åé›†ãƒ»é›†è¨ˆ | âœ… |
| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | âœ… |
| æœ€é©åŒ– | åˆ†æãƒ»æ¨å¥¨ | âœ… |

## ğŸš€ æ”¹å–„åŠ¹æœ

### Before (Phase 1)
- ä¾å­˜é–¢ä¿‚ã®æ‰‹å‹•ç®¡ç†
- ã‚¨ãƒ©ãƒ¼æ™‚ã®åŸå› ç‰¹å®šãŒå›°é›£
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãªã—
- æœ€é©åŒ–ã®æŒ‡é‡ãªã—

### After (Phase 2)
- **è‡ªå‹•ä¾å­˜é–¢ä¿‚è§£æ±º**: DIã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ç®¡ç†
- **ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç›£è¦–**: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§å•é¡Œã‚’æ—©æœŸç™ºè¦‹
- **å®šé‡çš„æ¸¬å®š**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã‚ˆã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å¯è¦–åŒ–
- **è‡ªå‹•æœ€é©åŒ–ææ¡ˆ**: ã‚·ã‚¹ãƒ†ãƒ ãŒæœ€é©åŒ–æ¡ˆã‚’æç¤º

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

| æŒ‡æ¨™ | Phase 1 | Phase 2 | æ”¹å–„ç‡ |
|-----|---------|---------|--------|
| ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–æ™‚é–“ | æ‰‹å‹• | è‡ªå‹•ï¼ˆ<100msï¼‰ | - |
| å•é¡Œæ¤œå‡ºæ™‚é–“ | å®Ÿè¡Œæ™‚ | èµ·å‹•æ™‚/å®šæœŸ | 90%çŸ­ç¸® |
| ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›† | ãªã— | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  | æ–°è¦ |
| æœ€é©åŒ–ææ¡ˆ | ãªã— | è‡ªå‹•ç”Ÿæˆ | æ–°è¦ |

## ğŸ”§ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

### RAGè¨­å®š (`config/rag_config.yaml`)
```yaml
embedding:
  model_name: sentence-transformers/multilingual-e5-large
  device: cuda
  batch_size: 32

vector_store:
  type: qdrant
  host: localhost
  port: 6333
  collection_name: documents

search:
  top_k: 10
  rerank: true

monitoring:
  health_check_interval: 60
  metrics_retention_minutes: 60
```

## ğŸ“ ä»Šå¾Œã®æ¨å¥¨äº‹é …

### çŸ­æœŸï¼ˆ1é€±é–“ï¼‰
1. âœ… ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   ```bash
   pip install spacy plotly streamlit
   ```

2. âœ… GPUåˆ©ç”¨ã®æœ‰åŠ¹åŒ–ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
   - è¨­å®šã§ `device: cuda` ã«å¤‰æ›´

3. âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
   - å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

### ä¸­æœŸï¼ˆ1ãƒ¶æœˆï¼‰
1. ğŸ“Š ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ§‹ç¯‰
   - Grafana/Prometheusã¨ã®çµ±åˆ

2. ğŸ”„ è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®å®Ÿè£…
   - è² è·ã«å¿œã˜ãŸãƒªã‚½ãƒ¼ã‚¹èª¿æ•´

3. ğŸ“± ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ã®è¿½åŠ 
   - ç•°å¸¸æ¤œå‡ºæ™‚ã®é€šçŸ¥

### é•·æœŸï¼ˆ3ãƒ¶æœˆï¼‰
1. ğŸŒ åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ
   - ãƒãƒ«ãƒãƒãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œ

2. ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
   - èªè¨¼ãƒ»èªå¯ã®å®Ÿè£…

3. ğŸ“ˆ æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æœ€é©åŒ–
   - ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å­¦ç¿’ã¨è‡ªå‹•èª¿æ•´

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 2 å®Œäº†é …ç›®
- [x] DIã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè£…
- [x] ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©ã¨ç™»éŒ²
- [x] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚·ã‚¹ãƒ†ãƒ 
- [x] ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚·ã‚¹ãƒ†ãƒ 
- [x] ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–ãƒ„ãƒ¼ãƒ«
- [x] çµ±åˆãƒ†ã‚¹ãƒˆã®ä½œæˆ
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆ

### å‹•ä½œç¢ºèªæ¸ˆã¿æ©Ÿèƒ½
- [x] PDFæ–‡æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- [x] ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ãƒ»è³ªå•å¿œç­”
- [x] æ¤œç´¢å±¥æ­´
- [x] æ–‡æ›¸ç®¡ç†
- [x] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- [x] ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†

## ğŸ‰ ã¾ã¨ã‚

Phase 2ã®å®Ÿè£…ã«ã‚ˆã‚Šã€RAGã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ç‚¹ã§å¤§å¹…ã«æ”¹å–„ã•ã‚Œã¾ã—ãŸï¼š

1. **ä¿å®ˆæ€§ã®å‘ä¸Š**: DIã‚³ãƒ³ãƒ†ãƒŠã«ã‚ˆã‚‹ç–çµåˆåŒ–
2. **ä¿¡é ¼æ€§ã®å‘ä¸Š**: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹ç›£è¦–
3. **å¯è¦³æ¸¬æ€§ã®å‘ä¸Š**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã«ã‚ˆã‚‹å¯è¦–åŒ–
4. **é‹ç”¨æ€§ã®å‘ä¸Š**: è‡ªå‹•æœ€é©åŒ–ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®RAGã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦ã®åŸºç›¤ãŒæ•´ã„ã¾ã—ãŸã€‚

---

**Version**: 2.0.0  
**Phase**: 2 Complete  
**Last Updated**: 2024-12-XX  
**Author**: AI_FT Team
