<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>MoE-RAG åŸ‹ã‚è¾¼ã¿UIãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            padding: 10px 20px;
            margin: 5px;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .test-button:hover {
            background: #8e44ad;
        }
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª MoE-RAG åŸ‹ã‚è¾¼ã¿UIãƒ†ã‚¹ãƒˆ</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã§åŸ‹ã‚è¾¼ã¿UIã®å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
        
        <h2>ãƒ†ã‚¹ãƒˆé …ç›®</h2>
        <div>
            <button class="test-button" onclick="testIframeLoad()">
                1. iframeã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
            </button>
            <button class="test-button" onclick="testViewSwitch()">
                2. ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ
            </button>
            <button class="test-button" onclick="testAPIConnection()">
                3. APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
            </button>
            <button class="test-button" onclick="runAllTests()">
                å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            </button>
        </div>
        
        <div id="test-results" class="result-box" style="display: none;">
            <h3>ãƒ†ã‚¹ãƒˆçµæœ</h3>
            <div id="results-content"></div>
        </div>
        
        <h2>åŸ‹ã‚è¾¼ã¿UIãƒ‡ãƒ¢</h2>
        <div style="border: 2px solid #9b59b6; border-radius: 8px; margin-top: 20px;">
            <iframe id="test-iframe" 
                    src="/static/moe_rag_ui.html" 
                    style="width: 100%; height: 500px; border: none;"
                    onload="iframeLoaded()">
            </iframe>
        </div>
    </div>
    
    <script>
        let testResults = [];
        
        function addResult(test, success, message) {
            testResults.push({test, success, message});
            updateResults();
        }
        
        function updateResults() {
            const resultsDiv = document.getElementById('test-results');
            const contentDiv = document.getElementById('results-content');
            
            resultsDiv.style.display = 'block';
            
            let html = '<ul>';
            testResults.forEach(result => {
                const className = result.success ? 'success' : 'error';
                const icon = result.success ? 'âœ…' : 'âŒ';
                html += `<li><span class="${className}">${icon} ${result.test}:</span> ${result.message}</li>`;
            });
            html += '</ul>';
            
            contentDiv.innerHTML = html;
        }
        
        function iframeLoaded() {
            console.log('iframe loaded successfully');
        }
        
        async function testIframeLoad() {
            const iframe = document.getElementById('test-iframe');
            
            try {
                // æ¤œç´¢UIã‚’èª­ã¿è¾¼ã¿
                iframe.src = '/static/moe_rag_ui.html';
                await new Promise(resolve => setTimeout(resolve, 2000));
                addResult('æ¤œç´¢UIèª­ã¿è¾¼ã¿', true, 'moe_rag_ui.htmlãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                
                // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°UIã‚’èª­ã¿è¾¼ã¿
                iframe.src = '/static/moe_training.html';
                await new Promise(resolve => setTimeout(resolve, 2000));
                addResult('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°UIèª­ã¿è¾¼ã¿', true, 'moe_training.htmlãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                
            } catch (error) {
                addResult('iframeèª­ã¿è¾¼ã¿', false, error.message);
            }
        }
        
        async function testViewSwitch() {
            const iframe = document.getElementById('test-iframe');
            
            try {
                // æ¤œç´¢UIã«åˆ‡ã‚Šæ›¿ãˆ
                iframe.src = '/static/moe_rag_ui.html';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°UIã«åˆ‡ã‚Šæ›¿ãˆ
                iframe.src = '/static/moe_training.html';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // å†åº¦æ¤œç´¢UIã«åˆ‡ã‚Šæ›¿ãˆ
                iframe.src = '/static/moe_rag_ui.html';
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                addResult('ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ', true, 'æ¤œç´¢UI â†” ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°UIã®åˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸ã«å‹•ä½œ');
                
            } catch (error) {
                addResult('ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ', false, error.message);
            }
        }
        
        async function testAPIConnection() {
            try {
                // MoE-RAGã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
                const statusResponse = await fetch('/api/moe-rag/status');
                if (statusResponse.ok) {
                    const statusData = await statusResponse.json();
                    addResult('MoE-RAG API', true, `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${statusData.available ? 'åˆ©ç”¨å¯èƒ½' : 'åˆ©ç”¨ä¸å¯'}`);
                } else {
                    addResult('MoE-RAG API', false, `HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${statusResponse.status}`);
                }
                
                // GPUçŠ¶æ…‹ç¢ºèª
                const gpuResponse = await fetch('/api/moe/training/gpu-status');
                if (gpuResponse.ok) {
                    const gpuData = await gpuResponse.json();
                    const gpuCount = gpuData.gpus ? gpuData.gpus.length : 0;
                    addResult('GPUçŠ¶æ…‹API', true, `GPUæ•°: ${gpuCount}`);
                } else {
                    addResult('GPUçŠ¶æ…‹API', false, `HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${gpuResponse.status}`);
                }
                
            } catch (error) {
                addResult('APIæ¥ç¶š', false, error.message);
            }
        }
        
        async function runAllTests() {
            testResults = [];
            addResult('ãƒ†ã‚¹ãƒˆé–‹å§‹', true, new Date().toLocaleString('ja-JP'));
            
            await testIframeLoad();
            await testViewSwitch();
            await testAPIConnection();
            
            addResult('ãƒ†ã‚¹ãƒˆå®Œäº†', true, 'å…¨ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
        window.addEventListener('load', async () => {
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testAPIConnection();
        });
    </script>
</body>
</html>